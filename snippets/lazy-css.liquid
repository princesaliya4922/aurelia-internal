{% assign css_url = filename | asset_url %}

{% case loading %}
  {% when 'preload' %}
    {% if device == 'desktop' %}
      <script>
        if (window.innerWidth >= 768) {
          document.head.insertAdjacentHTML(
            'beforeend',
            '<link rel="preload" as="style" href="{{ css_url }}" onload="this.onload=null;this.rel=\'stylesheet\'">'
          );
        }
      </script>
    {% elsif device == 'mobile' %}
      <script>
        if (window.innerWidth < 768) {
          document.head.insertAdjacentHTML(
            'beforeend',
            '<link rel="preload" as="style" href="{{ css_url }}" onload="this.onload=null;this.rel=\'stylesheet\'">'
          );
        }
      </script>
    {% else %}
      {{ filename | asset_url | stylesheet_tag: preload: true }}
    {% endif %}

  {% when 'low' %}
    {% if device == 'desktop' %}
      <script>
        if (window.innerWidth >= 768) {
          document.head.insertAdjacentHTML(
            'beforeend',
            '<link rel="stylesheet" href="{{ css_url }}" media="print" onload="this.media=\'all\'">'
          );
        }
      </script>
    {% elsif device == 'mobile' %}
      <script>
        if (window.innerWidth < 768) {
          document.head.insertAdjacentHTML(
            'beforeend',
            '<link rel="stylesheet" href="{{ css_url }}" media="print" onload="this.media=\'all\'">'
          );
        }
      </script>
    {% else %}
      <link rel="stylesheet" href="{{ css_url }}" media="print" onload="this.media='all'">
      <noscript><link rel="stylesheet" href="{{ css_url }}"></noscript>
    {% endif %}

  {% when 'lazy' %}
    <script>
      window._lazyCSS = window._lazyCSS || [];
      {% if device == 'desktop' %}
        if (window.innerWidth >= 768) {
          window._lazyCSS.push('{{ css_url }}');
        }
      {% elsif device == 'mobile' %}
        if (window.innerWidth < 768) {
          window._lazyCSS.push('{{ css_url }}');
        }
      {% else %}
        window._lazyCSS.push('{{ css_url }}');
      {% endif %}
    </script>

  {% else %}
    <link rel="stylesheet" href="{{ css_url }}">
{% endcase %}
